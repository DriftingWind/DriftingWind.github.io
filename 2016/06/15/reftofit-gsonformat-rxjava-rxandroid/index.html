<a href="https://github.com/DriftingWind"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a>
<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  
  <title>Retrofit、GsonFormat、RxJava、RxAndroid简单实践 | IAsk风</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
    <meta name="author" content="IAskWind">
  
  
    <meta name="description" content="rxjava、java、android、Retrofit、RxAndroid">
  
  <meta name="description" content="rxjava、java、android、Retrofit、RxAndroid">
<meta property="og:type" content="article">
<meta property="og:title" content="Retrofit、GsonFormat、RxJava、RxAndroid简单实践">
<meta property="og:url" content="http://iaskwind.com/2016/06/15/reftofit-gsonformat-rxjava-rxandroid/index.html">
<meta property="og:site_name" content="IAsk风">
<meta property="og:description" content="rxjava、java、android、Retrofit、RxAndroid">
<meta property="og:image" content="http://o8wlu6q9f.bkt.clouddn.com/5131D0FD-7FE4-40DB-81AD-283CC597D00C.png">
<meta property="og:updated_time" content="2016-06-17T07:55:55.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Retrofit、GsonFormat、RxJava、RxAndroid简单实践">
<meta name="twitter:description" content="rxjava、java、android、Retrofit、RxAndroid">
<meta name="twitter:image" content="http://o8wlu6q9f.bkt.clouddn.com/5131D0FD-7FE4-40DB-81AD-283CC597D00C.png">
  
    <link rel="alternate" href="/atom.xml" title="IAsk风" type="application/atom+xml">
  
  
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>

<body>
  <div class="wrapper">
    <header id="header">
  <div class="title">
    <h1><a href="/">IAsk风</a></h1>
    <p><a href="/">懂得倾听、懂得尊重、承担责任 才算成长</a></p>
  </div>
  <nav class="nav">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
        <li><a href="/about">About</a></li>
      
      
        <li><a href="/atom.xml">RSS</a></li>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
  <div class="clearfix"></div>
</header>
    <div class="content"><article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2016/06/15/reftofit-gsonformat-rxjava-rxandroid/">
  <time datetime="2016-06-15T14:11:54.000Z">
    2016-06-15
  </time>
</a>
    
    
  
    <h1 class="title">Retrofit、GsonFormat、RxJava、RxAndroid简单实践</h1>
  

  </header>
  
  <div class="entry">
    
    转载请附带原文地址:<a href="/2016/06/15/reftofit-gsonformat-rxjava-rxandroid/">http://iaskwind.com/2016/06/15/reftofit-gsonformat-rxjava-rxandroid/</a>
      <p>最近看了简书上很多说retrofit与rxjava的文章，所以今天我也来讲下我是如何用这些最新的东西的。废话不多说，直接上代码</p>
<a id="more"></a>
<h3 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h3><p>开发工具肯定是androidstudio，这点以后都不用说了吧，因为现在github上很多东西都是支持androidstudio，目前使用感觉很方便，简单一行，就能把所有的功能引入进来。接下来我会用到rxjava rxandroid retrofit rxlifecycle  具体的这些事什么请自行去查阅，最后的时候，我会放在相关具体介绍的链接</p>
<h6 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h6><p>下面一些*version是我在gradle中定义的变量，防止我每次都要改多次的问题</p>
<pre><code>ext {
    butterknifeVersion = &apos;8.0.1&apos;
    supportVersion = &apos;23.2.1&apos;
    retrofit2Version = &apos;2.0.2&apos;
    rxlifecycleVersion = &apos;0.5.0&apos;
}
</code></pre><p>下面的拷贝项目的build.gradle 而不是工程的里面（又啰嗦了）</p>
<pre><code>compile &apos;io.reactivex:rxjava:1.1.3&apos;
compile &apos;io.reactivex:rxandroid:1.1.0&apos;
compile &quot;com.squareup.retrofit2:retrofit:${retrofit2Version}&quot;
compile &quot;com.squareup.retrofit2:converter-gson:${retrofit2Version}&quot;
compile &quot;com.squareup.retrofit2:adapter-rxjava:${retrofit2Version}&quot;
 compile &quot;com.trello:rxlifecycle:${rxlifecycleVersion}&quot;
compile &quot;com.trello:rxlifecycle-components:${rxlifecycleVersion}&quot;
</code></pre><h6 id="rxlifecycle说明"><a href="#rxlifecycle说明" class="headerlink" title="rxlifecycle说明"></a>rxlifecycle说明</h6><p>此处使用rxlifecycle来处理一些订阅的回收</p>
<blockquote>
<p><a href="https://github.com/trello/RxLifecycle" target="_blank" rel="external">https://github.com/trello/RxLifecycle</a>就使被用来严格控制由于发布了一个订阅后，由于没有及时取消，导致Activity/Fragment无法销毁导致的内存泄露。</p>
</blockquote>
<p>既然我们要使用rxlifecycle就要按照它的规则来，我把目前的我的BaseActivity 继承 RxAppCompatActivity。具体使用的时候，我再说</p>
<hr>
<h3 id="GsonFormat使用"><a href="#GsonFormat使用" class="headerlink" title="GsonFormat使用"></a>GsonFormat使用</h3><p>假如服务端给我个接口，该接口返回json数据。</p>
<pre><code>接口地址：http://ip:端口/customer/getAppCutomerList 
请求方式：GET
请求参数(header):
参数名           类型       必填    参数位置        描述
accessToken     string     是     header        token
-------------------------------------------
请求参数(urlParam):
参数名         类型       必填      参数位置     描述
login_name    string    是        urlParam    登录名
pageNumber    int       是        urlParam    页数
name          string    是        urlParam    查询参数
</code></pre><p> 找个网络请求工具，我用的是Postmain谷歌浏览器的插件,填上对应的数据，按下send就能拿到对应的json<br>   <img src="http://o8wlu6q9f.bkt.clouddn.com/5131D0FD-7FE4-40DB-81AD-283CC597D00C.png" alt="postmain"><br>   好了，拿到服务端返回json可以创建实体了<br>   先随便创建个实体，我这里创建CustomerReturnBean，直接在实体名称上，点击右键generate…选择GsonFormat（前提：你已经装了这个插件）填入上面返回的json，看看对应的属性类型是否是你想要的，没有问题，点击ok，生成对应的实体。</p>
<h3 id="Retrofit实例创建"><a href="#Retrofit实例创建" class="headerlink" title="Retrofit实例创建"></a>Retrofit实例创建</h3><p>类：AccountsService</p>
<pre><code>public class AccountsService {

private static Retrofit.Builder retrofitBuilder = new Retrofit.Builder()
        .baseUrl(UrlContant.getBaseUrl())
        .addConverterFactory(GsonConverterFactory.create())
        .addCallAdapterFactory(RxJavaCallAdapterFactory.create());

public static AccountsApi createAccountsService() {
    return retrofitBuilder.build().create(AccountsApi.class);
}
}
</code></pre><p>对应的一些请求方法接口：</p>
<pre><code>public interface AccountsApi {
/**
 * 客户搜索查询接口
 *
 * @param loginName
 * @param pageNumber
 * @param name       查询关键字
 * @return
 */
@GET(UrlContant.searchCustomer)
Observable&lt;CustomerReturnBean&gt; searchCustomer(@Query(&quot;login_name&quot;) String     loginName, @Query(&quot;pageNumber&quot;) int pageNumber, @Query(&quot;name&quot;) String     name,@Header(&quot;accessToken&quot;) String accessToken);
}
</code></pre><p>因为我这里很方法都需要login_name accessToken,这个是登录的时候，获取到保存在本地的。我这里设置个辅助类：<br>类：AccountsApiHelper</p>
<pre><code>public class AccountsApiHelper {

private static AccountsApiHelper instance;
private static AccountsApi service;
private String userName;
private String accessToken;

public static synchronized AccountsApiHelper getInstance() {
    if (instance == null) {
        instance = new AccountsApiHelper();
    }
    //初始化一些参数
    instance.init();
    return instance;
}

private void init() {
    if (service == null) {
        service = AccountsService.createAccountsService();
    }

}

private void getValue() {
    userName = AppContext.getInstance().getLoginName();
    accessToken = AppContext.getInstance().getAccessToken();
}
/**
 * 客户搜索查询接口
 * @param pageNumber
 * @param searchValue
 * @return
 */
public Observable&lt;CustomerReturnBean&gt; searchCustomer(int pageNumber,String searchValue){
    getValue();
    return service.searchCustomer(userName,pageNumber,searchValue,accessToken);
}
}
</code></pre><p> 这里实例构建完成了</p>
<h3 id="Retrofit-RxJava请求数据"><a href="#Retrofit-RxJava请求数据" class="headerlink" title="Retrofit+RxJava请求数据"></a>Retrofit+RxJava请求数据</h3><pre><code>private void loadData(int pageNumber,final boolean isRefresh,String searchValue) {
    //上面创建的接口
    AccountsApiHelper.getInstance().searchCustomer(pageNumber,searchValue)
                .subscribeOn(Schedulers.io())
                .compose(this.&lt;CustomerReturnBean&gt;bindToLifecycle()) //这里用到rxlifecycle
                .doOnSubscribe(new Action0() { //处理一开始需要的进度条加载，一开始需要的ui里面执行的
                    @Override
                    public void call() {
                        if (!customerWsrefresh.isRefreshing()) {
                            ViewUtils.setViewVisibility(commonLoading, true);
                            newton_cradle_loading.start();
                        }
                    }
                })
                .subscribeOn(AndroidSchedulers.mainThread()) //这里的subscribeOn为上面的doOnSubscribe设定执行线程
                .observeOn(AndroidSchedulers.mainThread())
                .doOnTerminate(new Action0() { //结束执行 关闭进度加载
                    @Override
                    public void call() {
                        ViewUtils.setViewVisibility(commonLoading, false);
                        newton_cradle_loading.stop();
                    }
                })
                .observeOn(AndroidSchedulers.mainThread())
                .subscribe(new Action1&lt;CustomerReturnBean&gt;() {
                    @Override
                    public void call(CustomerReturnBean customerReturnBean) {
                        //成功执行
                        handlerSuccess(customerReturnBean, isRefresh);
                    }
                }, new Action1&lt;Throwable&gt;() {
                    @Override
                    public void call(Throwable throwable) {
                        handlerFailure(isRefresh);
                    }
                });
}
</code></pre><p>这里拿到数据，具体后面该怎么展示，各位看官随意。</p>
<p>各位感觉上面有什么错误和建议，欢迎提问谢谢</p>
<h3 id="补充："><a href="#补充：" class="headerlink" title="补充："></a>补充：</h3><p>有时候，我们需要延迟执行和放重复点击可以用如下：</p>
<pre><code>.throttleFirst(10,TimeUnit.SECONDS)//重复点击处理
.delay(manualCheck?0:3, TimeUnit.SECONDS)//延迟执行
</code></pre><h3 id="开源让世界更美好"><a href="#开源让世界更美好" class="headerlink" title="开源让世界更美好"></a>开源让世界更美好</h3><h3 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h3><p><a href="http://gank.io/post/560e15be2dca930e00da1083" target="_blank" rel="external">给 Android 开发者的 RxJava 详解</a></p>
<p><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/1122/3711.html" target="_blank" rel="external">Rxlifecycle使用详解，解决RxJava内存泄露问题</a></p>

    
  </div>
  <footer>
    
      
  <div class="categories">
    <a class="categories-link" href="/categories/Retrofit/">Retrofit</a>
  </div>

      
  <div class="tags">
    <a class="tags-link" href="/tags/Android/">Android</a>, <a class="tags-link" href="/tags/GsonFormat/">GsonFormat</a>, <a class="tags-link" href="/tags/Java/">Java</a>, <a class="tags-link" href="/tags/Retrofit/">Retrofit</a>, <a class="tags-link" href="/tags/RxAnroid/">RxAnroid</a>, <a class="tags-link" href="/tags/RxJava/">RxJava</a>
  </div>

    
    <div class="clearfix"></div>
  </footer>
</article>


<section id="comment">
  <h1 class="title">评论</h1>
  <div class="ds-thread" data-title="Retrofit、GsonFormat、RxJava、RxAndroid简单实践">
  </div>
</section>

</div>
  </div>
  <div class="widget-wrapper">
    <aside id="sidebar">
  
  
    
      
      

<div class="widget tag first">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/Retrofit/">Retrofit</a><small>1</small></li>
  
    <li><a href="/categories/Splash/">Splash</a><small>1</small></li>
  
    <li><a href="/categories/git/">git</a><small>1</small></li>
  
    <li><a href="/categories/sh/">sh</a><small>1</small></li>
  
  </ul>
</div>


    
      
      

<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/Android/" style="font-size: 10px;">Android</a> <a href="/tags/AwesomeSplash/" style="font-size: 10px;">AwesomeSplash</a> <a href="/tags/GIMP/" style="font-size: 10px;">GIMP</a> <a href="/tags/GsonFormat/" style="font-size: 10px;">GsonFormat</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/PicGif/" style="font-size: 10px;">PicGif</a> <a href="/tags/Retrofit/" style="font-size: 10px;">Retrofit</a> <a href="/tags/RxAnroid/" style="font-size: 10px;">RxAnroid</a> <a href="/tags/RxJava/" style="font-size: 10px;">RxJava</a> <a href="/tags/bash/" style="font-size: 10px;">bash</a> <a href="/tags/git-clone/" style="font-size: 10px;">git clone</a> <a href="/tags/git-tag/" style="font-size: 10px;">git tag</a> <a href="/tags/nvm/" style="font-size: 10px;">nvm</a> <a href="/tags/zsh/" style="font-size: 10px;">zsh</a>
  </div>
</div>


    
      
      

<div class="widget recent-posts">
  <h3 class="title">最近的文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2016/11/18/git_notes/">git 基本命令</a>
      </li>
    
      <li>
        <a href="/2016/06/24/command_notes/">一些命令和文章的记录</a>
      </li>
    
      <li>
        <a href="/2016/06/23/AwesomeSplash_svgpath/">一步步教你利用AwesomeSplash开源项目做炫酷启动页</a>
      </li>
    
      <li>
        <a href="/2016/06/15/reftofit-gsonformat-rxjava-rxandroid/">Retrofit、GsonFormat、RxJava、RxAndroid简单实践</a>
      </li>
    
  </ul>
</div>


    
  
</aside>
<div class="clearfix"></div>

  </div>
  <footer id="footer"> <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">
  
  &copy; 2016 <a href="/">IAskWind</a>
  
</div>
<div class="copyright">
<!-- 网易云音乐 -->
<!-- 单曲 -->

 
	<!-- 歌单 -->
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=450 src="http://music.163.com/outchain/player?type=0&id=490257777&auto=1&height=430"></iframe>
  

</div>
<div class="theme-copyright">
  Theme by <a href="https://github.com/heroicyang/hexo-theme-modernist" target="_blank">hexo-theme-modernist</a>
   |<span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
<script src="/js/scale.fix.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
  var duoshuoQuery = { short_name: 'driftingwind' };
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';
    ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
  (function($){
    $('.fancybox').fancybox();
  })(jQuery);
</script>

</body>
</html>